window.pageLoad=function(){Calculator.initCache();Calculator.initListeners();adjustFormHeight()};var Calculator=function(){var n={keyCodes:{0:"0",1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7",8:"8",9:"9",10:".",11:"±",12:"=",13:"+",14:"-",15:"*",16:"/",17:"%",18:"√",19:"x2",20:"1/x",21:"(",22:")",23:"yroot",24:"n!",25:"Exp",26:"^",27:"sin",28:"cos",29:"tan",30:"powten",31:"log",32:"sinh",33:"cosh",34:"tanh",35:"π",36:"↑",37:"CE",38:"C",39:"Back",40:"A",41:"B",42:"C",43:"D",44:"E",45:"F",46:"&",47:"|",48:"~"},operatorFacade:{13:"+",14:"-",15:"×",16:"÷",17:"%",23:"yroot",26:"^",46:"&",47:"|"},type:1,typePrefix:{1:"std-",2:"sci-",3:"pro-"},hasInited:{1:!0,2:!1,3:!1},constants:{mouseHoverColor:"#CFCFCF",firstMouseOutColor:"#F2F2F2",mouseOutColor:"#E6E6E6"},cache:{showInput:null,preStep:null,scaleSpans:null},getShowInput:function(){return n.cache.showInput.innerHTML},setShowInput:function(t){n.cache.showInput.innerHTML=t},getPreStep:function(){return n.cache.preStep.innerHTML},setPreStep:function(t){n.cache.preStep.innerHTML=t},operandStack:[],operatorStack:[],isPreInputBinaryOperator:!1,isPreInputUnaryOperator:!1,isPreInputEquals:!1,preResult:0,currentScale:10,isOverride:!1,intPattern:/^-?\d+$/,floatPattern:/^-?\d+\.\d+$/,scientificPattern:/^\d+\.\d+e(\+|-)\d+$/,hexPattern:/^[0-9A-F]+$/,operatorPriority:{")":0,"|":1,"&":2,"+":3,"-":3,"*":4,"%":4,"/":4,"^":5,yroot:5,"(":6},initCache:function(){var t=n.typePrefix[n.type];n.cache.showInput=document.getElementById(t+"show-input");n.cache.preStep=document.getElementById(t+"pre-step");n.type==3&&(n.cache.scaleSpans=document.getElementById("pro-scales").getElementsByTagName("span"))},listeners:{mouseHoverListener:function(t){var i=t||window.event;i.currentTarget.style.backgroundColor=n.constants.mouseHoverColor},firstMouseOutListener:function(t){var i=t||window.event;i.currentTarget.style.backgroundColor=n.constants.firstMouseOutColor},mouseOutListener:function(t){var i=t||window.event;i.currentTarget.style.backgroundColor=n.constants.mouseOutColor},keyPressListener:function(t){var i=t||window.event;n.handleKey(i.currentTarget.value)},toggleTypeBarListener:function(){var t=document.getElementById(n.typePrefix[n.type]+"type-bar");t.style.display=t.style.display==="block"?"none":"block"},switchTypeListener:function(t){var i=t||window.event;n.switchType(parseInt(i.currentTarget.value))},switchScaleListener:function(t){for(var i,f,o=t||window.event,s=document.getElementById("pro-scales").getElementsByTagName("div"),r=parseInt(o.currentTarget.getAttribute("scale")),u=n.currentScale,e=0,h=s.length;e<h;++e)s[e].removeAttribute("class");o.currentTarget.setAttribute("class","scale-active");r===16?(n.listeners._initFirstRowListeners(),u<10&&n.listeners._initSecondRowListeners()):r===10?u===16?(i=document.getElementById("pro-top-symbol").getElementsByTagName("li"),n.disableButtons(i,n.listeners.firstMouseOutListener)):n.listeners._initSecondRowListeners():r===8?u>8?(i=document.getElementById("pro-top-symbol").getElementsByTagName("li"),n.disableButtons(i,n.listeners.firstMouseOutListener),f=n.getElementsByAttribute("li","oct-disable",document.getElementById("pro-num-symbol")),n.disableButtons(f,n.listeners.mouseOutListener)):n.listeners._initSecondRowListeners():r===2&&(u===16&&(i=document.getElementById("pro-top-symbol").getElementsByTagName("li"),n.disableButtons(i,n.listeners.firstMouseOutListener)),f=n.getElementsByAttribute("li","bin-disable",document.getElementById("pro-num-symbol")),n.disableButtons(f,n.listeners.mouseOutListener));n.currentScale=r},_initFirstRowListeners:function(){var t=document.getElementById(n.typePrefix[n.type]+"top-symbol").getElementsByTagName("li");n.rebuildButtons(t,n.listeners.firstMouseOutListener)},_initSecondRowListeners:function(){var t=document.getElementById(n.typePrefix[n.type]+"num-symbol").getElementsByTagName("li");n.rebuildButtons(t,n.listeners.mouseOutListener);n.type===3&&n.disableButtons([document.getElementById("pro-point")],n.listeners.mouseOutListener)}},initListeners:function(){var f=n.typePrefix[n.type],e,r,t,i,u,o;for(n.type<3&&n.listeners._initFirstRowListeners(),n.listeners._initSecondRowListeners(),n.addEvent(document.getElementById(f+"show-bar"),"click",n.listeners.toggleTypeBarListener),e=document.getElementById(f+"type-bar"),lis=e.getElementsByTagName("li"),t=0,i=lis.length;t<i;++t)r=lis[t],r.className!=="calc-active"&&n.addEvent(r,"click",n.listeners.switchTypeListener);if(n.type===3)for(u=document.getElementById("pro-scales").getElementsByTagName("div"),t=0,i=u.length;t<i;++t)o=u[t],n.addEvent(o,"click",n.listeners.switchScaleListener)},handleKey:function(t){var i=parseInt(t);if(i<11||i>39&&i<46)n.showInput(n.keyCodes[i]),n.type===3&&n.showScales(n.getShowInput());else if((n.type===1||n.type===2)&&i==17)n.unaryOperate(function(n){return[n*.01]});else switch(i){case 11:n.unaryOperate(function(n){return(n+="",n==="0")?[n]:n.charAt(0)==="-"?[n.substring(1)]:["-"+n]});break;case 18:n.unaryOperate(function(n){return[Math.sqrt(n),"sqrt"]});break;case 19:n.unaryOperate(function(n){return[Math.pow(n,2),"sqr"]});break;case 20:n.unaryOperate(function(n){return[n===0?"0不能作为被除数":1/n,"1/"]});break;case 24:n.unaryOperate(function(t){return t<0&&(t=0-t),n.isFloat(t+"")&&(t=Math.floor(t)),[n.fact(t),"fact"]});break;case 25:n.unaryOperate(function(n){return[n.toExponential(7)]});break;case 27:n.unaryOperate(function(n){return[Math.sin(n),"sin"]});break;case 28:n.unaryOperate(function(n){return[Math.cos(n),"cos"]});break;case 29:n.unaryOperate(function(n){return[Math.tan(n),"tan"]});break;case 30:n.unaryOperate(function(n){return[Math.pow(10,n),"powten"]});break;case 31:n.unaryOperate(function(n){return[Math.log10(n),"log"]});break;case 32:n.unaryOperate(function(n){return[Math.sinh(n),"sinh"]});break;case 33:n.unaryOperate(function(n){return[Math.cosh(n),"cosh"]});break;case 34:n.unaryOperate(function(n){return[Math.tanh(n),"tanh"]});break;case 35:n.unaryOperate(function(){return[Math.PI]});break;case 48:n.unaryOperate(function(t){var i=eval("~"+t);return n.showScales(i),[i]});break;case 13:case 14:case 15:case 16:case 17:case 26:case 23:case 46:case 47:if(n.isPreInputBinaryOperator)break;n.isPreInputBinaryOperator=!0;n.isOverride=!0;n.binaryOperate(n.keyCodes[i],n.operatorFacade[i]);break;case 12:n.calculate();break;case 37:n.ce();break;case 38:n.clear();break;case 39:n.back();break;case 21:n.setPreStep(n.getPreStep()+" (");n.operatorStack.push("(");break;case 22:n.rightTag();break;case 36:n.setShowInput(n.preResult)}},unaryOperate:function(t){var i=n.getShowInput(),r,u;n.isInteger(i)?r=t(parseInt(i)):(n.isFloat(i)||n.isScientific(i))&&(r=t(parseFloat(i)));r!=null&&(n.setShowInput(n.checkLength(r[0])),r.length>1&&(n.isPreInputUnaryOperator?(u=n.getPreStep(),u=u.substring(0,u.lastIndexOf(" ")),u+=" "+r[1]+"("+i+")",n.setPreStep(u)):(n.setPreStep(n.getPreStep()+" "+r[1]+"("+i+")"),n.isPreInputUnaryOperator=!0)),n.isOverride=!0);n.isPreInputBinaryOperator=!1},binaryOperate:function(t,i){var f,e,r,u,o;n.type===3&&n.resetScales();f=n.getShowInput();e=n.getPreStep();n.isNumber(f)&&(n.operandStack.push(f),n.setPreStep(n.getPreStep()+(n.isPreInputUnaryOperator||e.charAt(e.length-1)===")"?" "+i:" "+f+" "+i)),r=n.operatorStack.pop(),r!=null&&(u=n.operatorPriority[t],o=n.operatorPriority[r],u>o?n.operatorStack.push(r):u>3&&u===o?(n.operatorStack.push(r),n.travelStack(1)):(n.operatorStack.push(r),n.setShowInput(n.checkLength(n.travelStack(null,u))))),n.operatorStack.push(t));n.isPreInputUnaryOperator=!1;n.isPreInputEquals=!1},calculate:function(){if(!n.isPreInputEquals){var i=n.getShowInput(),t;n.isNumber(i)&&(n.operandStack.push(i),t=n.checkLength(n.travelStack()),n.setShowInput(t),n.preResult=t,n.setPreStep("&nbsp;"),n.type===3&&n.showScales(t),n.isOverride=!0);n._reset();n.isPreInputEquals=!0}},travelStack:function(t,i){for(var r,f,e,u=n.operandStack[n.operandStack.length-1],s=t||n.operatorStack.length,h=i||0,o=0;o<s;++o){if(r=n.operatorStack.pop(),n.operatorPriority[r]<h||r==="("){n.operatorStack.push(r);break}e=n.operandStack.pop();f=n.operandStack.pop();u=n._stackHelper(f,e,r);n.operandStack.push(u)}return u},rightTag:function(){var i=n.getShowInput(),t,r,u,f;if(n.isNumber(i)){for(n.setPreStep(n.getPreStep()+(" "+i+" )")),n.operandStack.push(i),t=n.operatorStack.pop();t!=="("&&t!=null;)u=n.operandStack.pop(),r=n.operandStack.pop(),f=n._stackHelper(r,u,t),n.operandStack.push(f),t=n.operatorStack.pop();n.setShowInput(n.checkLength(n.operandStack.pop()))}},_stackHelper:function(t,i,r){var u,o,f,e;return r==="^"?u=Math.pow(t,i):r==="yroot"?u=Math.pow(t,1/i):n.type===3?(o=n.currentScale,o===10?u=eval(t+r+i):o===16?(f=parseInt(t,16),e=parseInt(i,16),u=eval(f+r+e).toString(16)):o===8?(f=parseInt(t,8),e=parseInt(i,8),u=eval(f+r+e).toString(8)):(f=parseInt(t,2),e=parseInt(i,2),u=eval(f+r+e).toString(2))):u=eval(t+r+i),u},checkLength:function(t){var i=t+"";return n.isFloat(i)&&(i=i.replace(/0+$/,"")),i.length>12?t.toExponential(7):i},ce:function(){n.setShowInput("0");n.type===3&&n.resetScales()},clear:function(){n.setShowInput("0");n.setPreStep("&nbsp;");n._reset();n.type===3&&n.resetScales()},resetScales:function(){for(var t=0;t<4;t++)n.cache.scaleSpans[t].innerHTML="0"},back:function(){var t=n.cache.showInput.innerText;n.setShowInput(t.length<2?"0":t.substring(0,t.length-1))},showScales:function(t){for(var r=n.calculateScales(t),u=n.cache.scaleSpans,i=0;i<4;++i)u[i].innerHTML=r[i]},calculateScales:function(t){var u=n.currentScale,i=[],r;return u===10?(r=parseInt(t),i[0]=r.toString(16),i[1]=r,i[2]=r.toString(8),i[3]=r.toString(2)):u===16?(r=parseInt(t,16),i[0]=t,i[1]=r,i[2]=r.toString(8),i[3]=r.toString(2)):u===8?(r=parseInt(t,8),i[0]=r.toString(16),i[1]=r,i[2]=t,i[3]=r.toString(2)):(r=parseInt(t,2),i[0]=r.toString(16),i[1]=r,i[2]=r.toString(8),i[3]=t),i},isNumber:function(t){return n.isInteger(t)||n.isFloat(t)||n.isScientific(t)||n.isHex(t)},isInteger:function(t){return t.match(n.intPattern)},isFloat:function(t){return t.match(n.floatPattern)},isScientific:function(t){return t.match(n.scientificPattern)},isHex:function(t){return t.match(n.hexPattern)},showInput:function(t){var r=n.getShowInput(),i=r;n.isOverride?i=t==="."?"0.":t:r.length<13&&(r==="0"?i=t==="."?"0.":t:i+=t);n.setShowInput(i);n.isOverride=!1;n.isPreInputBinaryOperator=!1;n.isPreInputUnaryOperator=!1;n.isPreInputEquals=!1},switchType:function(t){var i=n.typePrefix[n.type];document.getElementById(i+"type-bar").style.display="none";document.getElementById(i+"main").style.display="none";document.getElementById(n.typePrefix[t]+"main").style.display="block";n.type=t;n.hasInited[t]||(n.initListeners(),n.hasInited[t]=!0);n.initCache();n._reset()},_reset:function(){n.operandStack=[];n.operatorStack=[];n.isPreInputBinaryOperator=!1;n.isPreInputUnaryOperator=!1;n.isPreInputEquals=!1},addEvent:function(n,t,i){window.addEventListener?n.addEventListener(t,i):window.attachEvent&&n.attachEvent("on"+t,i)},removeEvent:function(n,t,i){window.removeEventListener?n.removeEventListener(t,i):window.detachEvent&&n.detachEvent("on"+t,i)},getElementsByAttribute:function(n,t,i){for(var o=i||document,r=[],e=o.getElementsByTagName(n),u,f=0,s=e.length;f<s;++f)u=e[f],u.getAttribute(t)!=null&&(r[r.length]=u);return r},fact:function(){function t(t){var i=n[t-1],r;if(i==null){for(i=1,r=1;r<=t;++r)i*=r;n[t-1]=i}return i}var n=[1];return t}(),disableButtons:function(t,i){for(var r,u=0,f=t.length;u<f;++u)r=t[u],r.setAttribute("class","disable-btn"),n.removeEvent(r,"click",n.listeners.keyPressListener),n.removeEvent(r,"mouseout",i),n.removeEvent(r,"mouseover",n.listeners.mouseHoverListener)},rebuildButtons:function(t,i){for(var r,u=0,f=t.length;u<f;++u)r=t[u],r.removeAttribute("class"),n.addEvent(r,"click",n.listeners.keyPressListener),n.addEvent(r,"mouseout",i),n.addEvent(r,"mouseover",n.listeners.mouseHoverListener)}};return n}();